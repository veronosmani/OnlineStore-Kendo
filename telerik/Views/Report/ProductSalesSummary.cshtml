@model IEnumerable<telerik.Models.ProductSalesViewModel>
@using telerik.Models
@using Kendo.Mvc.UI
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewBag.Title = "Product Sales Summary";
    var orderProducts = ViewBag.OrderProductList as List<OrderProductViewModel>;
    var orderProductsJson = Json.Serialize(orderProducts);
}

<h2>Order Details</h2>

@if (orderProducts != null && orderProducts.Any())
{
    <div id="orderDetailsGrid"></div>

    <script>
        var orderData = @Html.Raw(orderProductsJson);
    </script>

    <script>
        $(document).ready(function () {
            $("#orderDetailsGrid").kendoGrid({
                dataSource: {
                    data: orderData,
                    pageSize: 20
                },
                toolbar: ["excel", "pdf"],
                excel: {
                    fileName: "OrderDetails.xlsx",
                    filterable: true,
                    allPages: true
                },
                pdf: {
                    fileName: "OrderDetails.pdf",
                    allPages: true,
                    paperSize: "A4",
                    landscape: true,
                    repeatHeaders: true
                },
                pageable: true,
                sortable: true,
                filterable: true,
                groupable: true,
                columns: [
                    { field: "CustomerName", title: "Customer Name" },
                    { field: "OrderDate", title: "Order Date", format: "{0:dd-MM-yyyy}" },
                    { field: "ProductName", title: "Product Name" },
                    { field: "Quantity", title: "Quantity" },
        {
          field: "TotalPrice",
          title: "Total Price",
          template: "#= kendo.toString(TotalPrice, 'n2') # €"
        }                ]
            });
        });
    </script>

    <br />
    <div style="text-align:right; font-weight:bold; font-size:16px;">
        Total Revenue: @ViewBag.TotalRevenue.ToString("F2") €
    </div>
} else
{
    <div class="alert alert-info">
        No order details available.
    </div>
}

    <h2 class="mb-2">Stock</h2>

    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Product</th>
                <th>Units In Stock</th>
                <th>Units Sold</th>
                <th>Stock Left</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.ProductName</td>
                    <td>@item.UnitsInStock</td>
                    <td>@item.UnitsSold</td>
                    <td style="color:@(item.StockLeft < 5 ? "red" : "inherit")">@item.StockLeft</td>
                </tr>
            }
        </tbody>
    </table>