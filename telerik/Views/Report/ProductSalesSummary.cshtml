@model IEnumerable<telerik.Models.ProductSalesViewModel>
@using Kendo.Mvc.UI
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewBag.Title = "Product Sales Summary";
    var treeJson = Json.Serialize(ViewBag.TreeListData);
}

<h2>Orders Tree View</h2>

<div id="categoryTree"></div>

<script>
    var treeData = @Html.Raw(treeJson);

    $(document).ready(function () {
        $("#categoryTree").kendoTreeList({
            dataSource: {
                data: treeData,
                schema: {
                    model: {
                        id: "Id",
                        parentId: "ParentId",
                        fields: {
                            Id: { type: "number" },
                            ParentId: { type: "number", nullable: true }
                        },
                        expanded: true
                    }
                }
            },
            height: 600,
            sortable: true,
            columns: [
                {
                    field: "Name",
                    title: "Name",
                    template: function(data) {
                        if (data.Type === "Product") {
                            return "<strong>" + data.Name + "</strong>";
                        }
                        return data.Name;
                    }
                },
                { field: "Category", title: "Category" },
                { field: "Quantity", title: "Quantity" },
                { field: "OrderDate", title: "Order Date", format: "{0:dd-MM-yyyy}" },
                {
                    field: "TotalPrice",
                    title: "Total (€)",
                    template: "#= data.TotalPrice ? kendo.toString(TotalPrice, 'n2') + ' €' : '' #"
                }
            ]
        });
    });
</script>

<br />
<h2 class="mb-2">Stock Summary</h2>

<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Product</th>
            <th>Units In Stock</th>
            <th>Units Sold</th>
            <th>Stock Left</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.ProductName</td>
                <td>@item.UnitsInStock</td>
                <td>@item.UnitsSold</td>
                <td style="color:@(item.StockLeft < 5 ? "red" : "inherit")">@item.StockLeft</td>
            </tr>
        }
    </tbody>
</table>

<div class="text-end mt-3 fw-bold fs-5">
    Total Revenue: @ViewBag.TotalRevenue.ToString("F2") €
</div>
